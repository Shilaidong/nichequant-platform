# 古着与亚文化资产平台后端开发与部署方案

## 1. 技术栈选择

### 后端
- **框架**: Node.js + Express
- **数据库**: MongoDB + Mongoose
- **认证**: JWT (JSON Web Tokens)
- **文件存储**: Cloudinary (用于产品图片和用户头像)
- **AI集成**: Google Generative AI API (已在前端使用)

### 部署
- **后端**: Vercel 或 Render
- **前端**: Vercel
- **数据库**: MongoDB Atlas (云数据库)

## 2. 数据库设计

### 主要数据模型

#### 用户模型 (User)
- `name`: 用户名
- `email`: 邮箱 (唯一)
- `password`: 加密密码
- `avatarUrl`: 头像URL
- `createdAt`: 创建时间
- `updatedAt`: 更新时间

#### 产品模型 (Product)
- `name`: 产品名称
- `category`: 分类
- `price`: 价格
- `imageUrl`: 图片URL
- `seller`: 卖家ID (关联User)
- `description`: 产品描述
- `createdAt`: 创建时间
- `updatedAt`: 更新时间

#### 评价模型 (Testimonial)
- `quote`: 评价内容
- `name`: 用户名称
- `handle`: 用户名
- `avatarUrl`: 头像URL
- `createdAt`: 创建时间

#### 市场数据模型 (MarketData)
- `date`: 日期
- `value`: 数值
- `category`: 分类
- `createdAt`: 创建时间

## 3. API设计

### 认证相关
- `POST /api/auth/register` - 用户注册
- `POST /api/auth/login` - 用户登录
- `GET /api/auth/me` - 获取当前用户信息

### 产品相关
- `GET /api/products` - 获取产品列表
- `GET /api/products/:id` - 获取单个产品详情
- `POST /api/products` - 创建新产品
- `PUT /api/products/:id` - 更新产品
- `DELETE /api/products/:id` - 删除产品

### 评价相关
- `GET /api/testimonials` - 获取评价列表
- `POST /api/testimonials` - 创建评价

### 市场数据相关
- `GET /api/market-data` - 获取市场数据

### AI相关
- `POST /api/ai/verify` - 照片验证
- `POST /api/ai/valuate` - 价格估值

## 4. 开发计划

### 阶段1: 基础设置
1. 创建后端项目结构
2. 配置MongoDB连接
3. 实现用户认证功能
4. 部署基础后端服务

### 阶段2: 核心功能开发
1. 实现产品CRUD API
2. 实现评价API
3. 实现市场数据API
4. 集成文件上传功能

### 阶段3: AI功能集成
1. 集成Google GenAI API
2. 实现照片验证功能
3. 实现价格估值功能

### 阶段4: 前端集成
1. 修改前端组件，将模拟数据替换为API请求
2. 测试所有功能
3. 修复bug

### 阶段5: 部署
1. 部署前端到Vercel
2. 部署后端到Vercel或Render
3. 配置环境变量
4. 测试生产环境

## 5. 前端修改计划

### 修改组件
1. `FeaturedItems.tsx` - 将`MOCK_PRODUCTS`替换为API请求
2. `Testimonials.tsx` - 将`MOCK_TESTIMONIALS`替换为API请求
3. `MarketData.tsx` - 将`MOCK_CHART_DATA`替换为API请求
4. 添加产品详情页组件
5. 添加产品创建/编辑组件
6. 添加用户认证组件

### API请求封装
创建API请求封装文件，统一处理API请求和错误处理。

## 6. 部署步骤

### 后端部署
1. 创建MongoDB Atlas数据库
2. 配置环境变量
3. 部署到Vercel或Render
4. 测试API端点

### 前端部署
1. 修改前端配置，指向生产环境API
2. 部署到Vercel
3. 配置自定义域名（如果需要）
4. 测试生产环境应用

## 7. 安全性考虑

1. 实现输入验证和数据清洗
2. 实现密码加密存储
3. 实现JWT认证和授权
4. 配置CORS策略
5. 实现速率限制
6. 定期更新依赖

## 8. 监控和维护

1. 设置日志记录
2. 配置错误监控
3. 定期备份数据库
4. 监控API性能
5. 定期进行安全审计

## 9. 后续扩展计划

1. 实现搜索和过滤功能
2. 实现收藏和关注功能
3. 实现消息通知系统
4. 实现支付集成
5. 实现更复杂的AI功能

这个方案将确保古着与亚文化资产平台具有完整的后端支持和可靠的部署架构，能够满足前端的所有功能需求，并为未来的扩展打下基础。